<!DOCTYPE html>

<head>
    <title>Lesbian Baseball</title>
    <style>
        body {
            text-align: center;
            background-color: cornsilk;
        } 

        input { border: black solid 1px; }
        input:invalid { background-color: pink; }
        input:valid   { background-color: white; }
    </style>
</head>

<body>
    <h1>Lesbian Flag Generator</h1>

    <input 
        id          = "input" 
        type        = "text" 
        oninput     = "validate_input_and_update()" 
        placeholder = "lesbian"
        pattern     = "[lesbian]+"
    >

    <br>

    <button id="button" type="button" onclick="save_flag()" disabled> 
        Download your flag!
    </button>

    <p id="info">
        Type a word! Try "lesbian" or "baseball"!
    </p>

    <canvas id="canvas"></canvas> 
</body>

<script>

/*
    Configure a canvas to draw the flag 
*/

var canvas = document.getElementById("canvas");
var context = canvas.getContext("2d");

// This is fixed, and determines the size of the flag, since the aspect ratio
// will always be 2:3.
const FLAG_WIDTH = 1200; 

canvas.width = FLAG_WIDTH; 

const DEFAULT_FLAG_ASPECT_RATIO = (2.0 / 3.0);
const DEFAULT_NUM_STRIPES = 6;

const STRIPE_HEIGHT = 
    ((canvas.width * DEFAULT_FLAG_ASPECT_RATIO) / DEFAULT_NUM_STRIPES);
// Just making my calculation explicit there...

// Reference lesbian flag: 
// https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Lesbian_pride_flag_2018.svg/2000px-Lesbian_pride_flag_2018.svg.png

// It has six stripes, in six colours. These are:
const COLOURS = {
    'l' : "rgba(214, 41,  0  , 100)",
    'e' : "rgba(239, 119, 34 , 100)",
    's' : "rgba(255, 155, 85 , 100)",
    'b' : "rgba(255, 255, 255, 100)",
    'i' : "rgba(210, 98,  165, 100)",
    'a' : "rgba(182, 85,  145, 100)",
    'n' : "rgba(165, 0,   98 , 100)",
};


/*
    Utility
*/

// Check whether the user's input is considered valid by the <input>'s pattern
function input_is_valid() {
    return document.getElementById("input").matches("input:valid");
}

// Download the rendered flag as a PNG file. This is straight from StackOverflow
// so it's probably bad, sue me
function save_flag() {
    const word = get_input();
    var url = document.createElement('a');
    url.download = word + '.png';
    url.href = canvas.toDataURL();
    url.click();
}

// Get the user's input
function get_input() {
    return document.getElementById("input").value;
}

/*
    Render a flag!!
*/

// Check the input word is actually composed of the letters in 'lesbian', and if
// they are, update the rendered flag to represent the word.
function validate_input_and_update() {
    const input = get_input();

    // Handle invalid input
    if (!input_is_valid()) {
        document.getElementById("info").innerText 
            = "Your shit is invalid! Does your word have letters other than the ones in 'lesbian'?";

        // Disable the download button
        document.getElementById("button").disabled = true;
        return;
    }

    //
    // Otherwise it's valid, so generate a flag
    //

    // Enable the download button
    document.getElementById("button").disabled = false;

    // Print something encouraging...
    document.getElementById("info").innerText = "Done!"; 

    // Clear the previous flag...
    context.clearRect(0, 0, canvas.width, canvas.height);

    // There are as many stripes as letters, so we can calculate the flag size.
    canvas.height = (STRIPE_HEIGHT * input.length);

    // Render the stripes
    for (var i = 0; i < input.length; ++i) {
        const letter = input[i];
        const offset_from_top = (i * STRIPE_HEIGHT);

        // Set the colour corresponding to that letter
        context.fillStyle = COLOURS[letter];

        // Draw the stripe
        context.fillRect(0, offset_from_top, FLAG_WIDTH, STRIPE_HEIGHT);
    }

}

</script>